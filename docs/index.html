<!DOCTYPE html>
<html>
    <head>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes" /> 
    <meta name="viewport" content="width=device-width user-scalable=no">
    <style>
    @font-face {font-family: "Blender Pro"; src: url("//db.onlinewebfonts.com/t/a082fd3df68a0b54e0d4d794bc38d268.eot"); src: url("//db.onlinewebfonts.com/t/a082fd3df68a0b54e0d4d794bc38d268.eot?#iefix") format("embedded-opentype"), url("//db.onlinewebfonts.com/t/a082fd3df68a0b54e0d4d794bc38d268.woff2") format("woff2"), url("//db.onlinewebfonts.com/t/a082fd3df68a0b54e0d4d794bc38d268.woff") format("woff"), url("//db.onlinewebfonts.com/t/a082fd3df68a0b54e0d4d794bc38d268.ttf") format("truetype"), url("//db.onlinewebfonts.com/t/a082fd3df68a0b54e0d4d794bc38d268.svg#Blender Pro") format("svg"); }
    </style>
    </head>

    <body bgcolor="#ffffff">
        <canvas id="card">
            Your browser does not support the HTML5 canvas tag.
        </canvas>

        <script type="text/javascript" src="images.js"></script>
        <script type="text/javascript" src="lacerda.js"></script>
        <script>
            var current_card = null;    // XXX: These does not seem to work if placed in lacerda.js
            var current_round = 0;

            var refresh_canvas = function(card) {
                console.debug("refreshing canvas");

                var c = document.getElementById("card");
                var ctx = c.getContext("2d");
                ctx.drawImage(background, 0, 0, c.width, c.height);

                var txtRoundLabel = "ROUND " + current_round;
                var metrics = ctx.measureText(txtRoundLabel);
                ctx.fillStyle = "white";
                // OK, this next line is hacky af, but simple, and works...
                ctx.font = 42 * (c.width / background.width) + "px Blender Pro";
                ctx.fillText(txtRoundLabel, 0.75*c.width, 0.96*c.height);

                if (card != null) {
                    ctx.drawImage(actions[card[0]-1], 0, 0, c.width, c.height);
                    ctx.drawImage(missions[card[1]], 0, 0, c.width, c.height);
                    ctx.drawImage(hex_tiebreakers[card[2]], 0, 0, c.width, c.height);

                    if (card.length > 3) {
                        ctx.drawImage(turnorder, 0, 0, c.width, c.height);
                        ctx.drawImage(primary_turnorders[card[3]], 0, 0, c.width, c.height);
                        ctx.drawImage(secondary_turnorders[card[4]], 0, 0, c.width, c.height);
                    }
                }
            }
            
            window.onresize = function() {
                console.debug("resizing window");

                var c = document.getElementById("card");

                w = 0.95 * window.innerWidth;
                h = 0.95 * window.innerHeight;
                if (w/h <= img_ratio) {
                    c.width = w;
                    c.height = w / img_ratio;
                } else {
                    c.width = h * img_ratio;
                    c.height = h;
                }

                refresh_canvas(current_card);
            }

            window.onload = function() {
                var c = document.getElementById("card");
                c.onclick = function() {
                    current_card = draw();
                    console.debug(current_card);
                    refresh_canvas(current_card);
                }

                window.onresize();

                var ctx = c.getContext("2d");
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, c.width, c.height);
                ctx.drawImage(background, 0, 0, c.width, c.height);
            }
        </script>

</body>
</html>

